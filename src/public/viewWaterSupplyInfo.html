<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Water Supply Information</title>
    <!--<link rel="stylesheet" href="style.css">  Ensure this path is correct -->
    <link rel="stylesheet" href="forAll.css"> 

    <script src="main.js"></script> <!-- Assuming you need React for other parts of your project -->
   <!-- <style>
        .like-btn, .dislike-btn {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 5px 10px;
        margin: 5px;
        cursor: pointer;
        font-size: 16px;
    }

    .like-btn:hover {
        background-color: #e0ffe0;
    }

    .dislike-btn:hover {
        background-color: #ffe0e0;
    }

    </style>-->
</head>
<body>
    <nav>
        <button class="nav-toggle">‚ò∞</button>
        <ul>
            <li><a href="viewHealthSectorInfo.html" data-sector="Health sector">View Health Info</a></li>
            <li><a href="viewTourismInfo.html" data-sector="Tourism-info">Tourism Info</a></li>
            <li><a href="viewEventFestivalInfo.html" data-sector="Event&festival-info">View Event Info</a></li>
            <li><a href="viewWaterSupplyInfo.html" data-sector="Water Supply">View Water Supply Info</a></li>
            <li><a href="viewTransportationInfo.html" data-sector="Transportation">View Transportation Info</a></li>
            <li><a href="viewSecurityInfo.html" data-sector="Security-info">Security Info</a></li>
        </ul>
    </nav>

    <section class="content-section" id="postsContainer">
        <!-- Posts will be dynamically loaded here -->
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", async function() {
            const sector = decodeURIComponent('Water Supply');

            if (!sector) {
                document.getElementById('postsContainer').innerHTML = '<p style="color:red; text-align:center;">No sector selected.</p>';
                return;
            }

            try {
                const response = await fetch(`http://localhost:3000/api/post/posts_by_sector/${encodeURIComponent(sector)}`);
                const posts = await response.json();

                const postsContainer = document.getElementById('postsContainer');
                postsContainer.innerHTML = ''; // Clear previous posts

                posts.forEach(post => {
                    const postElement = document.createElement('div');
                    postElement.className = 'post';

                    const postTitle = document.createElement('h2');
                    postTitle.textContent = post.title;
                    postElement.appendChild(postTitle);

                    const postCategory = document.createElement('p');
                    postElement.appendChild(postCategory);

                    const postContent = document.createElement('p');
                    postContent.textContent = post.content;
                    postElement.appendChild(postContent);

                    // Add Like and Dislike buttons
const likeButton = document.createElement('button');
likeButton.textContent = `üëç ${post.likes || 0}`;
likeButton.className = 'like-btn';
likeButton.dataset.postId = post.id; // Set the data-post-id attribute here

const dislikeButton = document.createElement('button');
dislikeButton.textContent = `üëé ${post.dislikes || 0}`;
dislikeButton.className = 'dislike-btn';
dislikeButton.dataset.postId = post.id; // Set the data-post-id attribute here

postElement.appendChild(likeButton);
postElement.appendChild(dislikeButton);


                    if (post.imageUrl) {
                        const postContainer = document.createElement('div');
                        postContainer.className = 'post-container';

                        const postImage = document.createElement('img');
                        const imagePath = post.imageUrl.replace(/^src\/public/, "");
                        postImage.src = `http://localhost:3000${imagePath}`;
                        postElement.appendChild(postImage);

                        const description = document.createElement('div');
                        description.className = 'description';
                        postContainer.appendChild(description);

                        postElement.appendChild(postContainer);
                    } else {
                        const noImageMessage = document.createElement('p');
                        noImageMessage.textContent = 'No image available for this post.';
                        postElement.appendChild(noImageMessage);
                    }

                    const postAuthor = document.createElement('p');
                    postElement.appendChild(postAuthor);

                    const postDate = document.createElement('p');
                    postDate.className = 'date';
                    const postDateObj = new Date(post.createdAt);
                    postDate.textContent = `Posted on: ${postDateObj.toDateString()}`;
                    postElement.appendChild(postDate);

                    postsContainer.appendChild(postElement);
                });
            } catch (error) {
                console.error('Error fetching posts:', error);
                const errorMessage = document.createElement('p');
                errorMessage.textContent = 'Error fetching posts.';
                errorMessage.style.color = 'red';
                errorMessage.style.textAlign = 'center';
                document.getElementById('postsContainer').appendChild(errorMessage);
            }
        });

        document.querySelector('.nav-toggle').addEventListener('click', function() {
            document.querySelector('ul').classList.toggle('show');
        });
    </script>
    
    <script src="main.js"></script> <!-- External JavaScript file for like/dislike and other functionalities -->

</body>
</html>
